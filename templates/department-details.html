{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}{{ department.name }} - DentCare{% endblock %}
{% block heading_title %}{{ department.name }}{% endblock %}
{% block heading_desc %}{{ department.description }}{% endblock %}
{% block breadcrumb %}
  <li><a href="{% url 'departments' %}">Bo'limlar</a></li>
  <li>{{ department.name }}</li>
{% endblock %}

{% block content %}

    <!-- Department Details Section -->
    <section id="department-details" class="department-details section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row align-items-center">
          <div class="col-lg-7">
            <div class="department-content" data-aos="fade-right" data-aos-delay="200">
              <div class="department-header">
                <div class="specialty-tag">
                  <i class="{{ department.icon }}"></i>
                  <span>{{ department.name }}</span>
                </div>
                <h1 class="department-name">{{ department.name }}</h1>
                <p class="department-description">{{ department.description }}</p>
              </div>

              <!-- Xizmatlar Highlights -->
              {% if services %}
              <div class="service-highlights" data-aos="fade-up" data-aos-delay="300">
                <h3>Maxsus Xizmatlar</h3>
                <div class="highlights-grid">

                  {% for service in services|slice:":3" %}
                  <div class="highlight-card">
                    <div class="highlight-icon">
                      <i class="{{ service.icon }}"></i>
                    </div>
                    <h4>{{ service.name }}</h4>
                    <p>{{ service.short_description|truncatewords:15 }}</p>
                    {% if service.price_from %}
                    <div class="service-price">
                      <span>{{ service.price_from|floatformat:0|intcomma }} so'm dan</span>
                    </div>
                    {% endif %}
                  </div>
                  {% endfor %}

                </div>
              </div>
              {% endif %}

              <div class="cta-section" data-aos="fade-up" data-aos-delay="400">
                <a href="{% url 'appointment' %}" class="btn-appointment">
                  <i class="bi bi-calendar-plus"></i>
                  <span>Qabulga Yozilish</span>
                </a>
                <div class="contact-quick">
                  <span class="contact-label">Tezkor Aloqa</span>
                  <span class="contact-number">{{ settings.phone|default:"+998 71 123 45 67" }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-5">
            <div class="visual-section" data-aos="fade-left" data-aos-delay="300">
              <div class="main-visual">
                {% if department.image %}
                <img src="{{ department.image.url }}" alt="{{ department.name }}" class="img-fluid department-image">
                {% else %}
                <img src="{% static 'assets/img/health/cardiology-3.webp' %}" alt="{{ department.name }}" class="img-fluid department-image">
                {% endif %}

                <div class="stats-overlay" data-aos="zoom-in" data-aos-delay="500">
                  <div class="stat-item">
                    <span class="stat-number">10+</span>
                    <span class="stat-label">Shifokorlar</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-number">15+</span>
                    <span class="stat-label">Xizmatlar</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="department-details" data-aos="fade-up" data-aos-delay="600">
          <div class="row">
            <div class="col-lg-8">
              <div class="details-content">
                <h3>{{ department.name }} Haqida</h3>

                {% if department.full_description %}
                  {{ department.full_description|linebreaks }}
                {% else %}
                  <p>{{ department.description }}</p>
                {% endif %}

                <!-- Shifokorlar Ro'yxati -->
                {% if doctors %}
                <div class="doctors-section mt-5">
                  <h3 class="mb-4">
                    <i class="bi bi-people me-2"></i>
                    Bizning Mutaxassislar
                  </h3>
                  <div class="row g-4">
                    {% for doctor in doctors %}
                    <div class="col-md-6">
                      <div class="doctor-card">
                        <div class="doctor-photo">
                          {% if doctor.photo %}
                          <img src="{{ doctor.photo.url }}" alt="Dr. {{ doctor.first_name }} {{ doctor.last_name }}">
                          {% else %}
                          <img src="{% static 'assets/img/doctors/default.jpg' %}" alt="Doctor">
                          {% endif %}
                        </div>
                        <div class="doctor-info">
                          <h4>Dr. {{ doctor.first_name }} {{ doctor.last_name }}</h4>
                          <p class="specialization">{{ doctor.specialization }}</p>
                          <div class="doctor-meta">
                            <span class="experience">
                              <i class="bi bi-award"></i>
                              {{ doctor.experience_years }} yil tajriba
                            </span>
                            <span class="rating">
                              <i class="bi bi-star-fill"></i>
                              {{ doctor.rating }}
                            </span>
                          </div>
                        </div>
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}

                <!-- Xizmatlar Ro'yxati -->
                {% if services %}
                <div class="services-section mt-5">
                  <h3 class="mb-4">
                    <i class="bi bi-list-check me-2"></i>
                    Barcha Xizmatlar
                  </h3>
                  <div class="services-list">
                    {% for service in services %}
                    <div class="service-item">
                      <div class="service-icon">
                        <i class="{{ service.icon }}"></i>
                      </div>
                      <div class="service-content">
                        <h4>{{ service.name }}</h4>
                        <p>{{ service.short_description }}</p>
                      </div>
                      <div class="service-info">
                        {% if service.price_from %}
                        <div class="price">
                          <span>{{ service.price_from|floatformat:0|intcomma }}</span>
                          {% if service.price_to %}
                          - <span>{{ service.price_to|floatformat:0|intcomma }}</span>
                          {% endif %}
                          <span class="currency">so'm</span>
                        </div>
                        {% endif %}
                        {% if service.duration %}
                        <div class="duration">
                          <i class="bi bi-clock"></i>
                          {{ service.duration }} daqiqa
                        </div>
                        {% endif %}
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}
              </div>
            </div>

            <div class="col-lg-4">
              <div class="info-sidebar" data-aos="fade-left" data-aos-delay="700">

                <!-- Ish Vaqti -->
                {% if working_hours %}
                <div class="info-card">
                  <h4>
                    <i class="bi bi-clock-history me-2"></i>
                    Ish Vaqti
                  </h4>
                  <div class="hours-list">
                    {% for hour in working_hours %}
                    <div class="hours-item">
                      <span>{{ hour.get_day_display }}</span>
                      {% if hour.is_working_day and hour.opening_time %}
                        <span>{{ hour.opening_time|time:"H:i" }} - {{ hour.closing_time|time:"H:i" }}</span>
                      {% else %}
                        <span class="text-muted">Dam olish</span>
                      {% endif %}
                    </div>
                    {% endfor %}
                  </div>
                </div>
                {% endif %}

                <!-- Bog'lanish -->
                <div class="info-card contact-card">
                  <h4>
                    <i class="bi bi-telephone me-2"></i>
                    Bog'lanish
                  </h4>
                  <div class="contact-info">
                    {% if settings %}
                    <a href="tel:{{ settings.phone }}" class="contact-link">
                      <i class="bi bi-phone-fill"></i>
                      <span>{{ settings.phone }}</span>
                    </a>
                    <a href="mailto:{{ settings.email }}" class="contact-link">
                      <i class="bi bi-envelope-fill"></i>
                      <span>{{ settings.email }}</span>
                    </a>
                    {% else %}
                    <a href="tel:+998711234567" class="contact-link">
                      <i class="bi bi-phone-fill"></i>
                      <span>+998 71 123 45 67</span>
                    </a>
                    {% endif %}
                  </div>
                  <a href="{% url 'appointment' %}" class="btn btn-primary w-100 mt-3">
                    <i class="bi bi-calendar-check me-2"></i>
                    Qabulga Yozilish
                  </a>
                </div>

                <!-- Tezkor Havolalar -->
                <div class="info-card">
                  <h4>
                    <i class="bi bi-link-45deg me-2"></i>
                    Tezkor Havolalar
                  </h4>
                  <div class="quick-links">
                    <a href="{% url 'services' %}">
                      <i class="bi bi-arrow-right"></i>
                      <span>Barcha Xizmatlar</span>
                    </a>
                    <a href="{% url 'doctors' %}">
                      <i class="bi bi-arrow-right"></i>
                      <span>Mutaxassislar</span>
                    </a>
                    <a href="{% url 'departments' %}">
                      <i class="bi bi-arrow-right"></i>
                      <span>Boshqa Bo'limlar</span>
                    </a>
                    <a href="{% url 'faq' %}">
                      <i class="bi bi-arrow-right"></i>
                      <span>Savol-Javoblar</span>
                    </a>
                    <a href="{% url 'contact' %}">
                      <i class="bi bi-arrow-right"></i>
                      <span>Bog'lanish</span>
                    </a>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>

      </div>

    </section><!-- /Department Details Section -->

    <style>
    /* Doctor Card Styling */
    .doctor-card {
      display: flex;
      gap: 15px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
    }

    .doctor-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 25px rgba(0,0,0,0.12);
    }

    .doctor-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
    }

    .doctor-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .doctor-info h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
      color: #2c3e50;
    }

    .doctor-info .specialization {
      font-size: 13px;
      color: #3fbbc0;
      margin-bottom: 8px;
    }

    .doctor-meta {
      display: flex;
      gap: 15px;
      font-size: 12px;
      color: #6c757d;
    }

    .doctor-meta i {
      color: #3fbbc0;
      margin-right: 3px;
    }

    /* Service Item Styling */
    .service-item {
      display: flex;
      align-items: start;
      gap: 15px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }

    .service-item:hover {
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transform: translateX(5px);
    }

    .service-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #3fbbc0 0%, #2a9ba3 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      flex-shrink: 0;
    }

    .service-content {
      flex: 1;
    }

    .service-content h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 5px;
      color: #2c3e50;
    }

    .service-content p {
      font-size: 14px;
      color: #6c757d;
      margin: 0;
    }

    .service-info {
      text-align: right;
    }

    .service-info .price {
      font-size: 18px;
      font-weight: 700;
      color: #3fbbc0;
      margin-bottom: 5px;
    }

    .service-info .currency {
      font-size: 14px;
      font-weight: 400;
    }

    .service-info .duration {
      font-size: 13px;
      color: #6c757d;
    }

    .service-info .duration i {
      color: #3fbbc0;
      margin-right: 3px;
    }

    /* Contact Card */
    .contact-card .contact-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 10px;
      text-decoration: none;
      color: #2c3e50;
      transition: all 0.3s ease;
    }

    .contact-card .contact-link:hover {
      background: #3fbbc0;
      color: white;
    }

    .contact-card .contact-link i {
      color: #3fbbc0;
      font-size: 18px;
    }

    .contact-card .contact-link:hover i {
      color: white;
    }

    /* Service Price Badge */
    .service-price {
      margin-top: 8px;
      padding: 5px 12px;
      background: #e8f5f5;
      border-radius: 20px;
      display: inline-block;
    }

    .service-price span {
      color: #3fbbc0;
      font-weight: 600;
      font-size: 13px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .service-item {
        flex-direction: column;
        text-align: center;
      }

      .service-info {
        text-align: center;
      }

      .doctor-card {
        flex-direction: column;
        text-align: center;
      }

      .doctor-photo {
        margin: 0 auto;
      }
    }
    </style>

{% endblock %}